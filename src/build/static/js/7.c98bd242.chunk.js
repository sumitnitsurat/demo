(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[7],{108:function(e,t){},111:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var a=n(54),r=n.n(a),c=n(55),o=n(14),i=n(0),s=n.n(i),d=n(37),l=n(75),m=n.n(l),u=n(77);m()().format();var f={generateRandomString:function(){return Math.random().toString(36).slice(2).substring(0,15)},closeVideo:function(e){document.getElementById(e)&&(document.getElementById(e).remove(),this.adjustVideoElemSize())},pageHasFocus:function(){return!(document.hidden||document.onfocusout||window.onpagehide||window.onblur)},getQString:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e=e||window.location.href;var n=decodeURIComponent(e).split("#",2)[0].split("?",2)[1];if(n){var a=n.split("&");if(a.length){var r={};return a.forEach((function(e){var t=e.split("=",2);t.length&&(r[t[0]]=t[1])})),t?r[t]?r[t]:null:r}return null}return null},userMediaAvailable:function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},getUserFullMedia:function(){if(this.userMediaAvailable())return navigator.mediaDevices.getUserMedia({video:!0,audio:{echoCancellation:!0,noiseSuppression:!0}});throw new Error("User media not available")},getUserAudio:function(){if(this.userMediaAvailable())return navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}});throw new Error("User media not available")},shareScreen:function(){if(this.userMediaAvailable())return navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});throw new Error("User media not available")},getIceServer:function(){return{iceServers:[{urls:["stun:ss-turn1.xirsys.com"]},{username:"R44mgQPZ_HZxSXJbZRehQBjU_2rWIdq546HmpK958l_XrAj5rkK8e6Lt6_ssD8ULAAAAAF7kVy5zdW1pdGM=",credential:"14807cf8-ad2f-11ea-8c40-0242ac140004",urls:["turn:ss-turn1.xirsys.com:80?transport=udp","turn:ss-turn1.xirsys.com:3478?transport=udp","turn:ss-turn1.xirsys.com:80?transport=tcp","turn:ss-turn1.xirsys.com:3478?transport=tcp","turns:ss-turn1.xirsys.com:443?transport=tcp","turns:ss-turn1.xirsys.com:5349?transport=tcp"]}]}},addChat:function(e,t){var n=document.querySelector("#chat-messages"),a="justify-content-end",r="You",c="bg-white";"remote"===t&&(a="justify-content-start",r=e.sender,c="",this.toggleChatNotificationBadge());var o=document.createElement("div");o.className="sender-info",o.innerHTML="".concat(r," - ").concat(m()().format("Do MMMM, YYYY h:mm a"));var i=document.createElement("div");i.className="col-10 card chat-card msg ".concat(c),i.innerHTML=e.msg;var s=document.createElement("div");s.className="row ".concat(a," mb-2"),i.appendChild(o),s.appendChild(i),n.appendChild(s),this.pageHasFocus&&s.scrollIntoView()},toggleChatNotificationBadge:function(){document.querySelector("#chat-pane").classList.contains("chat-opened")?document.querySelector("#new-chat-notification").setAttribute("hidden",!0):document.querySelector("#new-chat-notification").removeAttribute("hidden")},replaceTrack:function(e,t){var n=!!t.getSenders&&t.getSenders().find((function(t){return t.track&&t.track.kind===e.kind}));return n?n.replaceTrack(e):""},toggleShareIcons:function(e){var t=document.querySelector("#share-screen");e?(t.setAttribute("title","Stop sharing screen"),t.children[0].classList.add("text-primary"),t.children[0].classList.remove("text-app")):(t.setAttribute("title","Share screen"),t.children[0].classList.add("text-app"),t.children[0].classList.remove("text-primary"))},toggleVideoBtnDisabled:function(e){document.getElementById("toggle-video").disabled=e},maximiseStream:function(e){var t=e.target.parentElement.previousElementSibling;t.requestFullscreen()||t.mozRequestFullScreen()||t.webkitRequestFullscreen()||t.msRequestFullscreen()},singleStreamToggleMute:function(e){e.target.classList.contains("fa-microphone")?(e.target.parentElement.previousElementSibling.muted=!0,e.target.classList.add("fa-microphone-slash"),e.target.classList.remove("fa-microphone")):(e.target.parentElement.previousElementSibling.muted=!1,e.target.classList.add("fa-microphone"),e.target.classList.remove("fa-microphone-slash"))},saveRecordedStream:function(e,t){var n=new Blob(e,{type:"video/webm"}),a=new File([n],"".concat(t,"-").concat(m()().unix(),"-record.webm"));Object(u.saveAs)(a)},toggleModal:function(e,t){var n=document.getElementById(e);t?(n.style.display="block",n.removeAttribute("aria-hidden")):(n.style.display="none",n.setAttribute("aria-hidden",!0))},setLocalStream:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.getElementById("local");n.srcObject=e,t?n.classList.add("mirror-mode"):n.classList.remove("mirror-mode")},adjustVideoElemSize:function(){for(var e=document.getElementsByClassName("card"),t=e.length,n=t<=2?"50%":3==t?"33.33%":t<=8?"25%":t<=15?"20%":t<=18?"16%":t<=23?"15%":t<=32?"12%":"10%",a=0;a<t;a++)e[a].style.width=n,e[a].style.maxWidth=600},createDemoRemotes:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,a=0,r=setInterval((function(){var c=document.createElement("video");c.id="demo-".concat(a,"-video"),c.srcObject=e,c.autoplay=!0,c.className="remote-video";var o=document.createElement("div");o.className="remote-video-controls",o.innerHTML='<i class="fa fa-microphone text-app pr-3 mute-remote-mic" title="Mute"></i>\n                <i class="fa fa-expand text-app expand-remote-video" title="Expand"></i>';var i=document.createElement("div");i.className="card card-sm",i.id="demo-".concat(a),i.appendChild(c),i.appendChild(o),document.getElementById("videos").appendChild(i),t.adjustVideoElemSize(),++a==n&&clearInterval(r)}),2e3)}},g=n(78),p=[],v=n.n(g)()("/stream"),h="",b="",E="",y=[],k="",w=function(e){for(var t=e,n=document.getElementsByClassName("room-comm"),a=sessionStorage.getItem("username"),o=0;o<n.length;o++)n[o].attributes.removeNamedItem("hidden");function i(e,t){p[t]=new RTCPeerConnection(f.getIceServer()),E&&E.getTracks().length?E.getTracks().forEach((function(e){p[t].addTrack(e,E)})):b?b.getTracks().forEach((function(e){p[t].addTrack(e,b)})):f.getUserFullMedia().then((function(e){b=e,e.getTracks().forEach((function(n){p[t].addTrack(n,e)})),f.setLocalStream(e)})).catch((function(e){console.error("stream error: ".concat(e))})),e&&(p[t].onnegotiationneeded=Object(c.a)(r.a.mark((function e(){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p[t].createOffer();case 2:return n=e.sent,e.next=5,p[t].setLocalDescription(n);case 5:v.emit("sdp",{description:p[t].localDescription,to:t,sender:h});case 6:case"end":return e.stop()}}),e)})))),p[t].onicecandidate=function(e){var n=e.candidate;v.emit("ice candidates",{candidate:n,to:t,sender:h})},p[t].ontrack=function(e){var n=e.streams[0];if(document.getElementById("".concat(t,"-video")))document.getElementById("".concat(t,"-video")).srcObject=n;else{var a=document.createElement("video");a.id="".concat(t,"-video"),a.srcObject=n,a.autoplay=!0,a.className="remote-video";var r=document.createElement("div");r.className="remote-video-controls",r.innerHTML='<i class="fa fa-microphone text-app pr-3 mute-remote-mic" title="Mute"></i>\n                        <i class="fa fa-expand text-app expand-remote-video" title="Expand"></i>';var c=document.createElement("div");c.className="card card-sm",c.id=t,c.appendChild(a),c.appendChild(r),document.getElementById("videos").appendChild(c),f.adjustVideoElemSize()}},p[t].onconnectionstatechange=function(e){switch(p[t].iceConnectionState){case"disconnected":case"failed":case"closed":f.closeVideo(t)}},p[t].onsignalingstatechange=function(e){switch(p[t].signalingState){case"closed":console.log("Signalling state is 'closed'"),f.closeVideo(t)}}}function s(){return f.toggleVideoBtnDisabled(!1),new Promise((function(e,t){E.getTracks().length&&E.getTracks().forEach((function(e){return e.stop()}));e()})).then((function(){f.toggleShareIcons(!1),d(b,"video")})).catch((function(e){console.error(e)}))}function d(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];f.setLocalStream(e,n);var a="audio"==t?e.getAudioTracks()[0]:e.getVideoTracks()[0];for(var r in p){var c=p[r];"object"==typeof p[c]&&f.replaceTrack(a,p[c])}}f.getUserFullMedia().then((function(e){b=e,f.setLocalStream(e)})).catch((function(e){console.error("stream error: ".concat(e))})),v.on("connect",(function(){h=v.io.engine.id,v.emit("subscribe",{room:t,socketId:h}),v.on("new user",(function(e){v.emit("newUserStart",{to:e.socketId,sender:h}),p.push(e.socketId),i(!0,e.socketId)})),v.on("newUserStart",(function(e){p.push(e.sender),i(!1,e.sender)})),v.on("ice candidates",function(){var e=Object(c.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.candidate){e.next=6;break}return e.next=3,p[t.sender].addIceCandidate(new RTCIceCandidate(t.candidate));case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0="";case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),v.on("sdp",function(){var e=Object(c.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("offer"!==t.description.type){e.next=12;break}if(!t.description){e.next=7;break}return e.next=4,p[t.sender].setRemoteDescription(new RTCSessionDescription(t.description));case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0="";case 8:e.t0,f.getUserFullMedia().then(function(){var e=Object(c.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return document.getElementById("local").srcObject||f.setLocalStream(n),b=n,n.getTracks().forEach((function(e){p[t.sender].addTrack(e,n)})),e.next=5,p[t.sender].createAnswer();case 5:return a=e.sent,e.next=8,p[t.sender].setLocalDescription(a);case 8:v.emit("sdp",{description:p[t.sender].localDescription,to:t.sender,sender:h});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e)})),e.next=15;break;case 12:if("answer"!==t.description.type){e.next=15;break}return e.next=15,p[t.sender].setRemoteDescription(new RTCSessionDescription(t.description));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),v.on("chat",(function(e){f.addChat(e,"remote")}))})),document.getElementById("chat-input").addEventListener("keypress",(function(e){13===e.which&&e.target.value.trim()&&(e.preventDefault(),function(e){var n={room:t,msg:e,sender:a};v.emit("chat",n),f.addChat(n,"local")}(e.target.value),setTimeout((function(){e.target.value=""}),50))})),document.getElementById("toggle-video").addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("toggle-video");b.getVideoTracks()[0].enabled?(e.target.classList.remove("fa-video"),e.target.classList.add("fa-video-slash"),t.setAttribute("title","Show Video"),b.getVideoTracks()[0].enabled=!1):(e.target.classList.remove("fa-video-slash"),e.target.classList.add("fa-video"),t.setAttribute("title","Hide Video"),b.getVideoTracks()[0].enabled=!0),d(b,"video")})),document.getElementById("toggle-mute").addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("toggle-mute");b.getAudioTracks()[0].enabled?(e.target.classList.remove("fa-microphone-alt"),e.target.classList.add("fa-microphone-alt-slash"),t.setAttribute("title","Unmute"),b.getAudioTracks()[0].enabled=!1):(e.target.classList.remove("fa-microphone-alt-slash"),e.target.classList.add("fa-microphone-alt"),t.setAttribute("title","Mute"),b.getAudioTracks()[0].enabled=!0),d(b,"audio")})),document.getElementById("share-screen").addEventListener("click",(function(e){e.preventDefault(),E&&E.getVideoTracks().length&&"ended"!=E.getVideoTracks()[0].readyState?s():f.shareScreen().then((function(e){f.toggleShareIcons(!0),f.toggleVideoBtnDisabled(!0),E=e,d(e,"video",!1),E.getVideoTracks()[0].addEventListener("ended",(function(){s()}))})).catch((function(e){console.error(e)}))}))},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"screen";if(console.log("recoerd is clien"),!k||"inactive"==k.state)return"screen"===e?L():N();"paused"==k.state?k.resume():"recording"==k.state&&k.stop()};function S(e){var t=sessionStorage.getItem("username");(k=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9"})).start(1e3),k.ondataavailable=function(e){y.push(e.data)},k.onstop=function(){f.saveRecordedStream(y,t),setTimeout((function(){y=[]}),3e3)},k.onerror=function(e){console.error(e)}}var L=function(){return E&&E.getVideoTracks().length?(S(E),!0):f.shareScreen().then((function(e){return S(e),!0})).catch((function(){return!1}))},N=function(){if(b&&b.getTracks().length)return S(b),!0;f.getUserFullMedia().then((function(e){return S(e),!0})).catch((function(){return!1}))};function I(e){return s.a.createElement("nav",{className:"col-4 col-md-4 col-xs-12 offset-md-4 fixed-bottom rounded-0 d-print-none",style:{zIndex:999}},s.a.createElement("div",{className:"pull-right room-comm",hidden:!0},s.a.createElement("button",{className:"btn btn-sm rounded-0 btn-no-effect mr-3 mb-4",id:"toggle-video",title:"Hide Video"},s.a.createElement("i",{className:"fa fa-video fa-3x text-app"})),s.a.createElement("button",{className:"btn btn-sm rounded-0 btn-no-effect mr-3 mb-4",id:"toggle-mute",title:"Mute"},s.a.createElement("i",{className:"fa fa-microphone-alt fa-3x text-app"})),s.a.createElement("button",{className:"btn btn-sm rounded-0 btn-no-effect mr-3 mb-4",id:"share-screen",title:"Share screen"},s.a.createElement("i",{className:"fa fa-desktop fa-3x text-app"})),s.a.createElement("button",{className:"btn btn-sm text-app pull-right btn-no-effect mr-3 mb-4",id:"toggle-chat-pane"},s.a.createElement("i",{className:"fa fa-comment fa-3x"})," ",s.a.createElement("span",{className:"badge badge-danger very-small font-weight-lighter",id:"new-chat-notification",hidden:!0},"New"))))}var T=function(){return s.a.createElement("div",{className:"custom-modal",id:"recording-options-modal",style:{display:"none"}},s.a.createElement("div",{className:"custom-modal-content"},s.a.createElement("div",{className:"row text-center"},s.a.createElement("div",{className:"col-md-6 mb-2"},s.a.createElement("span",{className:"record-option",id:"record-video"},"Record video")),s.a.createElement("div",{className:"col-md-6 mb-2"},s.a.createElement("span",{className:"record-option",id:"record-screen"},"Record screen"))),s.a.createElement("div",{className:"row mt-3"},s.a.createElement("div",{className:"col-md-12 text-center"},s.a.createElement("button",{className:"btn btn-outline-danger",id:"closeModal"},"Close")))))},M=n(38),C=(n(111),n(2));t.default=function(){var e=Object(C.g)().meetingId,t=Object(i.useState)(!1),n=Object(o.a)(t,2),a=n[0],s=n[1],l=Object(C.f)().push;Object(i.useEffect)((function(){document.querySelector("#toggle-chat-pane").addEventListener("click",(function(e){var t=document.querySelector("#chat-pane"),n=document.querySelector("#main-section");t.classList.contains("chat-opened")?(t.setAttribute("hidden",!0),n.classList.remove("col-md-9"),n.classList.add("col-md-12"),t.classList.remove("chat-opened")):(t.attributes.removeNamedItem("hidden"),n.classList.remove("col-md-12"),n.classList.add("col-md-9"),t.classList.add("chat-opened")),setTimeout((function(){document.querySelector("#chat-pane").classList.contains("chat-opened")&&f.toggleChatNotificationBadge()}),300)})),document.getElementById("local").addEventListener("click",(function(){document.pictureInPictureElement?document.exitPictureInPicture().catch((function(e){console.error(e)})):document.getElementById("local").requestPictureInPicture().catch((function(e){console.error(e)}))})),document.addEventListener("click",(function(e){e.target&&e.target.classList.contains("expand-remote-video")?f.maximiseStream(e):e.target&&e.target.classList.contains("mute-remote-mic")&&f.singleStreamToggleMute(e)})),document.getElementById("closeModal").addEventListener("click",(function(){f.toggleModal("recording-options-modal",!1)})),w(e)}),[e]);var m=function(){var e=Object(c.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t);case 2:n=e.sent,console.log(n),s(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return i.createElement(i.Fragment,null,i.createElement(T,null),i.createElement(d.a,null,i.createElement("div",null,!a&&i.createElement(M.a,{variant:"outline-info",onClick:function(){return m("media")},style:{marginRight:10}},"Record Video"),"  ",!a&&i.createElement(M.a,{variant:"outline-info",onClick:function(){return m("screen")},style:{marginRight:10}},"Record Screen"),"   ",a&&i.createElement(M.a,{variant:"outline-danger",onClick:function(){return x(),void s(!1)},style:{marginRight:10}},"Stop Recording"),"   ",i.createElement(M.a,{variant:"danger",onClick:function(){return l("/")}},"Leave Session"),"  ")),i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row"},i.createElement("video",{className:"local-video mirror-mode",id:"local",volume:"0",autoPlay:!0,muted:!0})),i.createElement("div",{className:"row"},i.createElement("div",{className:"col-md-12 main",id:"main-section"},i.createElement("div",{className:"row mt-2 mb-2",id:"videos"})),i.createElement("div",{className:"col-md-3 chat-col d-print-none mb-2 bg-app-secondary",id:"chat-pane",hidden:!0},i.createElement("div",{className:"row"},i.createElement("div",{className:"col-12 text-center h2 mb-3"},"CHAT")),i.createElement("div",{id:"chat-messages"}),i.createElement("div",{className:"row"},i.createElement("textarea",{id:"chat-input",className:"form-control rounded-0 chat-box border-info",rows:"3",placeholder:"Type here..."}))))),i.createElement(I,null))}},37:function(e,t,n){"use strict";var a=n(0),r=n(117);t.a=function(e){var t=e.children;return a.createElement(r.a,{className:"justify-content-between bg-app",sticky:"top",variant:"light"},a.createElement(r.a.Brand,{href:"/"},a.createElement("img",{alt:"",src:"/logo.svg",width:"30",height:"30",className:"d-inline-block align-top"})," ",a.createElement("span",{style:{color:"#fff",fontWeight:600}},"Namaste Talk")),t||null)}}}]);
//# sourceMappingURL=7.c98bd242.chunk.js.map